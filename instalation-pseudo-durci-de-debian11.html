<!DOCTYPE html><html lang="fr"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Instalation pseudo durci de Debian11 - blog.labperso.ovh</title><meta name="description" content="Introduction Pour faire suite à mon ancien billet de blog sur la création d’un NAS sous Debian 9, vu que l’on est maintenant sous Debian 11,&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://nidouille.github.io/instalation-pseudo-durci-de-debian11.html"><link rel="alternate" type="application/atom+xml" href="https://nidouille.github.io/feed.xml" title="blog.labperso.ovh - RSS"><link rel="alternate" type="application/json" href="https://nidouille.github.io/feed.json" title="blog.labperso.ovh - JSON"><meta property="og:title" content="Instalation pseudo durci de Debian11"><meta property="og:image" content="https://nidouille.github.io/media/website/logo-stream-png.avif"><meta property="og:site_name" content="blog.labperso.ovh"><meta property="og:description" content="Introduction Pour faire suite à mon ancien billet de blog sur la création d’un NAS sous Debian 9, vu que l’on est maintenant sous Debian 11,&hellip;"><meta property="og:url" content="https://nidouille.github.io/instalation-pseudo-durci-de-debian11.html"><meta property="og:type" content="article"><link rel="preload" href="https://nidouille.github.io/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://nidouille.github.io/assets/dynamic/fonts/jetbrainsmono/jetbrainsmono-italic.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://nidouille.github.io/assets/css/style.css?v=0de5ed4b6a37ab1ddecf11b6f3d8bbb5"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://nidouille.github.io/instalation-pseudo-durci-de-debian11.html"},"headline":"Instalation pseudo durci de Debian11","datePublished":"2021-11-19T00:00+01:00","dateModified":"2025-04-07T15:06+02:00","image":{"@type":"ImageObject","url":"https://nidouille.github.io/media/website/logo-stream-png.avif","height":false,"width":false},"description":"Introduction Pour faire suite à mon ancien billet de blog sur la création d’un NAS sous Debian 9, vu que l’on est maintenant sous Debian 11,&hellip;","author":{"@type":"Person","name":"Nida","url":"https://nidouille.github.io/authors/nida/"},"publisher":{"@type":"Organization","name":"Nida","logo":{"@type":"ImageObject","url":"https://nidouille.github.io/media/website/logo-stream-png.avif","height":false,"width":false}}}</script><noscript><style>img[loading] {
                    opacity: 1;
                }</style></noscript></head><body class="post-template"><div class="container container--center"><header class="header"><div class="header__logo"><a class="logo" href="https://nidouille.github.io/"><img src="https://nidouille.github.io/media/website/logo-stream-png.avif" alt="blog.labperso.ovh" width="" height=""></a></div></header><main class="content"><article class="post"><header><h1 class="post__title">Instalation pseudo durci de Debian11</h1><div class="post__meta"><time datetime="2021-11-19T00:00" class="post__date">novembre 19, 2021</time></div></header><div class="post__entry"><div class="post-content"><h1 id="introduction">Introduction</h1><p>Pour faire suite à mon ancien billet de blog sur la création d’un <a href="https://blog.labperso.ovh/post/nas_debian_9/">NAS sous Debian 9</a>, vu que l’on est maintenant sous Debian 11, pas mal d’évolution sur installation du système d’exploitation. Voici un mix de ce que je fais entre le personnel et le travail lors d’une installation de Debian. Au travail, c’est une logique installation dite durci. Dans le cas présent, comme c’est chez moi, je me laisse l’accès à l’utilisateur root et pas de sudo.</p><h1 id="partitionnement">Partitionnement</h1><p>Suivant mes besoins, je ne partitionne pas de la même manière. Il est souvent conseillé de découper au maximum, mais je trouve que cela augmente la perte de disque exploitable. Mais une partition est forcément isolée, <strong>/boot</strong>.</p><p>Suivant les utilisations, je crée :</p><ul><li>var/log : pour éviter que des logs trop verbeux viennent à remplir le stockage</li><li>/var/lib/mysql : isoler la base de données du reste du système</li><li>/var/lib/postgresql : isoler la base de données du reste du système</li><li>/var/www : isoler la partie publiée par le serveur html</li><li>/home : si pas d’utilisateur, cela permet de configurer la partition en lecture seule</li></ul><table><thead><tr><th>Point de montage</th><th>Options</th><th>Notes</th></tr></thead><tbody><tr><td>/boot</td><td>nosuid,nodev,noexec,noauto</td><td>Partition à protéger</td></tr><tr><td>/var/log</td><td>nosuid,nodev,noexec</td><td>Logs du système</td></tr><tr><td>/home</td><td>nosuid,nodev,noexec</td><td>En cas de non utilisation de /home</td></tr></tbody></table><ul><li>nosuid : ignore les bits setuid et setgid</li><li>nodev : ignore les fichiers de périphériques</li><li>noexec : empêche les binaires d’être exécutés</li><li>noauto : ne monte pas la partition</li><li>nouser : seul root pourra monter la partition</li></ul><p>Pour plus d’information : <a href="https://wiki.debian.org/fr/fstab">https://wiki.debian.org/fr/fstab</a></p><h1 id="installation-de-debian-11">Installation de Debian 11</h1><h2 id="partitionnement-1">Partitionnement</h2><p>Les tailles pour /var/log, /home et swap sont indicatif. Car dans mon cas /home sera en lecture seule et que la taille peut être petite.</p><h3 id="bios">BIOS</h3><table><thead><tr><th>Point de montage</th><th>LVM</th><th>Taille</th><th>Système de fichier</th><th>flag boot</th><th>Options</th></tr></thead><tbody><tr><td>/boot</td><td>-</td><td>512 Mo</td><td>ext4</td><td>O</td><td>nosuid,nodev,noexec,noauto</td></tr><tr><td>/</td><td>O</td><td> </td><td> </td><td>-</td><td>defaults</td></tr><tr><td>/var/log</td><td>O</td><td>4 Go</td><td>ext4</td><td>-</td><td>nosuid,nodev,noexec</td></tr><tr><td>/home</td><td>O</td><td>100 Mo</td><td>ext4</td><td>-</td><td>nosuid,nodev,noexec</td></tr><tr><td>swap</td><td>O</td><td>1 Go</td><td>-</td><td>-</td><td>-</td></tr></tbody></table><h3 id="uefi">UEFI</h3><table><thead><tr><th>Point de montage</th><th>LVM</th><th>Taille</th><th>Système de fichier</th><th>flag boot</th><th>Options</th></tr></thead><tbody><tr><td>/boot/efi</td><td>-</td><td>512 Mo</td><td>FAT32</td><td>O</td><td>umask=0077</td></tr><tr><td>/boot</td><td>-</td><td>512 Mo</td><td>ext4</td><td>-</td><td>nosuid,nodev,noexec,noauto</td></tr><tr><td>/</td><td>O</td><td> </td><td> </td><td>-</td><td>defaults</td></tr><tr><td>/var/log</td><td>O</td><td>4 Go</td><td>ext4</td><td>-</td><td>nosuid,nodev,noexec</td></tr><tr><td>/home</td><td>O</td><td>512 Mo</td><td>ext4</td><td>-</td><td>nosuid,nodev,noexec</td></tr><tr><td>swap</td><td>O</td><td>1 Go</td><td>-</td><td>-</td><td>-</td></tr></tbody></table><p><img src="https://blog.labperso.ovh/images/debian_11/01.png" alt="" loading="lazy" data-is-external-image="true"></p><h2 id="logiciels">Logiciels</h2><p>C’est simple, on installe rien, cela sera fait par la suite..</p><p><img src="https://blog.labperso.ovh/images/debian_11/02.png" alt="" loading="lazy" data-is-external-image="true"></p><h1 id="post-installation">Post installation</h1><h2 id="openssh">OpenSSH</h2><h3 id="installation-du-server-openssh">Installation du server OpenSSH</h3><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">apt install openssh-server
</code></pre></div><h3 id="configuration-du-serveur">Configuration du serveur</h3><p>Changement du port par défaut : Port XX</p><pre tabindex="0"><code class="hljs apache"><span class="hljs-attribute">Port</span> <span class="hljs-number">9227</span>
</code></pre><p>Forcer le protocol ssh en V2</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">Protocol 2
</code></pre></div><p>Activer les log</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">SyslogFacility AUTH
LogLevel INFO
</code></pre></div><p>Autoriser la connexion par clefs publique</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">PubkeyAuthentication yes
</code></pre></div><p>Limiter le nombre de tentatives de mot de passe : MaxAuthTries X</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">MaxAuthTries 2
</code></pre></div><p>Désactiver le forwarding</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">AllowTcpForwarding no
X11Forwarding no
</code></pre></div><h2 id="firewall">Firewall</h2><p>Pour le firewall, j’utilise UFW.</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">apt install ufw
</code></pre></div><ul><li>Autoriser le ssh</li></ul><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">ufw allow port_ssh/tcp
</code></pre></div><p>ou</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">ufw allow proto tcp from 192.168.1.0/24 port port_ssh
</code></pre></div><ul><li>Refuser les connexions entrantes</li></ul><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">ufw default deny
</code></pre></div><ul><li>Activer la journalisation</li></ul><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">ufw logging on
</code></pre></div><ul><li>Activer le firewall</li></ul><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">ufw enable
</code></pre></div><ul><li>Stratus du firewall</li></ul><div class="highlight"><pre tabindex="0"><code class="language-Shell hljs" data-lang="Shell">ufw status
</code></pre></div><ul><li>Désactiver le firewall</li></ul><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">ufw disable
</code></pre></div><ul><li>Afficher les règles du firewall</li></ul><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">ufw status verbose
</code></pre></div><h2 id="mises-a-jours-automatique">Mises a jours automatique</h2><p>Comme je suis faignante à la maison, j’automatise les mises à jour critique du système via le paquet unattended-upgrades.</p><h5 id="installation">Installation</h5><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">apt install unattended-upgrades apt-listchanges
</code></pre></div><h5 id="etcaptaptconfd50unattended-upgrades">/etc/apt/apt.conf.d/50unattended-upgrades</h5><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">Unattended-Upgrade::Origins-Pattern {
        // Codename based matching:
        // This will follow the migration of a release through different
        // archives (e.g. from testing to stable and later oldstable).
        // Software will be the latest available for the named release,
        // but the Debian release itself will not be automatically upgraded.
//      "origin=Debian,codename=${distro_codename}-updates";
//      "origin=Debian,codename=${distro_codename}-proposed-updates";
        "origin=Debian,codename=${distro_codename},label=Debian";
        "origin=Debian,codename=${distro_codename},label=Debian-Security";
        "origin=Debian,codename=${distro_codename}-security,label=Debian-Security";

        // Archive or Suite based matching:
        // Note that this will silently match a different release after
        // migration to the specified archive (e.g. testing becomes the
        // new stable).
//      "o=Debian,a=stable";
//      "o=Debian,a=stable-updates";
//      "o=Debian,a=proposed-updates";
//      "o=Debian Backports,a=${distro_codename}-backports,l=Debian Backports";
};
</code></pre></div><p>Par défaut ce concentre que sur le coté sécurité</p><p>La section <strong>Unattended-Upgrade::Package-Blacklist</strong> est intéressante pour ne pas mettre à jour certains paquets</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">// The following matches all packages starting with linux-
//  "linux-";

    // Use $ to explicitely define the end of a package name. Without
    // the $, "libc6" would match all of them.
//  "libc6$";
//  "libc6-dev$";
//  "libc6-i686$";

    // Special characters need escaping
//  "libstdc\+\+6$";

    // The following matches packages like xen-system-amd64, xen-utils-4.1,
    // xenstore-utils and libxenstore3.0
//  "(lib)?xen(store)?";

    // For more information about Python regular expressions, see
    // https://docs.python.org/3/howto/regex.html
};
</code></pre></div><p>Les notifications</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">// Send email to this address for problems or packages upgrades
// If empty or unset then no email is sent, make sure that you
// have a working mail setup on your system. A package that provides
// 'mailx' must be installed. E.g. "user@example.com"
Unattended-Upgrade::Mail "root";

// Set this value to one of:
//    "always", "only-on-error" or "on-change"
// If this is not set, then any legacy MailOnlyOnError (boolean) value
// is used to chose between "only-on-error" and "on-change"
Unattended-Upgrade::MailReport "only-on-error";
</code></pre></div><p>Dans mon cas, c’est sur l’utilisateur root que seront reçus les mails de notification et uniquement pour les erreurs.</p><p>Dans le cadre professionnel, j’utilise un e-mail dédié et le mail sera avec l’option <em>on-change</em> pour garder l’historique. Et il faut bien sûr avoir de configuré un serveur de messagerie comme exim et d’avoir installé le paquet <em>bsd-mailx</em> ou <em>mailutils</em></p><h5 id="etcaptaptconfd20auto-upgrades">/etc/apt/apt.conf.d/20auto-upgrades</h5><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">APT::Periodic::Update-Package-Lists "1";
APT::Periodic::Unattended-Upgrade "1";
APT::Periodic::Download-Upgradeable-Packages "1";
APT::Periodic::AutocleanInterval "30";
</code></pre></div><ul><li>Update-Package-Lists: 1 activer l’auto-update, 0 désactiver</li><li>Unattended-Upgrade: 1 activer l’auto-upgrade, 0 désactiver</li><li>Download-Upgradeable-Packages : Définit la fréquente en jours pour le téléchargement des paquets</li><li>AutocleanInterval: Active le nettoyage automatique des paquets pendant X jours. Cette configuration affiche 30 jours</li></ul><h5 id="tester-la-configuration">Tester la configuration</h5><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">unattended-upgrades --debug --dry-run 
</code></pre></div><h2 id="kernel-pour-les-vm">Kernel pour les VM</h2><p>Si on a la flemme de compiler son kernel, debian fournit un kernel pour les environnements virtualisés qui enlève pas mal de module n’ayant aucun intérêt.</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">apt install linux-image-cloud-amd64
</code></pre></div><h2 id="sysctl">sysctl</h2><p>Pour cette section qui est plus d’ordre informatif, je fais référence au guide de configuration de l'<a href="https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf">ANSSI</a> (page 21 du document), document qui est utilisé comme référence (tout comme ceux du <a href="https://www.cisecurity.org/">CIS</a> ou du <a href="https://www.cisa.gov/">CISA</a>) dans mon travail.</p><h3 id="ip-forwarding">IP Forwarding</h3><p>Je désactive la possibilité de faire transiter des paquets IPv4 d’une interface à une autre. A ne pas faire sur une installation pour un routeur ;)</p><ul><li>Méthode temporaire : via systemctl</li></ul><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">sysctl -w net.ipv4.ip_forward = 0
</code></pre></div><ul><li>Méthode 1 : /etc/sysctl.conf</li></ul><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">net.ipv4.ip_forward = 0
</code></pre></div><p>Pour que les modifications soient prisent en charges</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">sysctl -p
</code></pre></div><ul><li>Méthode 2 : /etc/sysctl.d/60-disable-ipv4-forward.conf</li></ul><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">net.ipv4.ip_forward = 0
</code></pre></div><p>Pour que les modifications soient prisent en charges</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">sysctl -p -f /etc/sysctl.d/60-disable-ipv4-forward.conf
</code></pre></div><h3 id="désactivation-de-lipv6">Désactivation de l’IPv6</h3><p>Je vais me faire réprimander par les défenseurs de cette technologie, mais si le réseau sur lequel vous avez vos serveurs n’est que IPv4, on peut désactiver le protocole IPv6.</p><ul><li>Méthode temporaire : via systemctl</li></ul><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">sysctl -w net.ipv6.conf.all.disable_ipv6=1
sysctl -w net.ipv6.conf.default.disable_ipv6=1
sysctl -w net.ipv6.conf.lo.disable_ipv6=1
</code></pre></div><ul><li>Méthode 1 : /etc/sysctl.conf</li></ul><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">net.ipv6.conf.all.disable_ipv6=1
net.ipv6.conf.default.disable_ipv6=1
net.ipv6.conf.lo.disable_ipv6=1
</code></pre></div><p>Si ca ne concerne qu’une seule interface réseau</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">net.ipv6.conf.enp0s3.disable_ipv6 = 1
</code></pre></div><p>Pour que les modifications soient prisent en charges</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">sysctl -p
</code></pre></div><ul><li>Méthode 2 : /etc/sysctl.d/70-disable-ipv6.conf</li></ul><p>Toute les interfaces</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">net.ipv6.conf.all.disable_ipv6 = 1
</code></pre></div><p>Une interface en particulier</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">net.ipv6.conf.enp0s3.disable_ipv6 = 1
</code></pre></div><p>Pour que les modifications soient prisent en charges</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">sysctl -p -f /etc/sysctl.d/70-disable-ipv6.conf
</code></pre></div><h3 id="restreindre-accès-au-buffer-de-dmesg">Restreindre accès au buffer de dmesg</h3><p>Seul un utilisateur privilégié pourra accéder a certaines informations collecter par dsmeg.</p><div class="highlight"><pre tabindex="0"><code class="language-shell hljs" data-lang="shell">kernel.dmesg_restrict = 1
</code></pre></div></div><footer class="post-footer"><ul class="post-tags"><li> </li></ul></footer></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on avril 7, 2025</p><div class="post__share"></div></footer><nav class="pagination"><div class="pagination__title"><span>Read other posts</span></div><div class="pagination__buttons"><a href="https://nidouille.github.io/cloud-de-confiance-vs-cloud-souverain-le-faux-debat.html" class="btn previous" rel="prev" aria-label="[MISSING TRANSLATION]:  Cloud de confiance vs cloud souverain, le faux débat ? "><span class="btn__icon">←</span> <span class="btn__text">Cloud de confiance vs cloud souverain, le faux débat ?</span> </a><a href="https://nidouille.github.io/securisation-basique-de-son-proxmox.html" class="btn next" rel="next" aria-label="[MISSING TRANSLATION]:  Sécurisation basique de son Proxmox "><span class="btn__text">Sécurisation basique de son Proxmox</span> <span class="btn__icon">→</span></a></div></nav></article></main><footer class="footer"><div class="footer__inner"><div class="footer__copyright"><p>© 2024 Powered by Publii CMS :: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank" rel="noopener">Theme</a> ported by the <a href="https://getpublii.com/customization-service/" target="_blank" rel="noopener">Publii Team</a></p></div></div></footer></div><script defer="defer" src="https://nidouille.github.io/assets/js/scripts.min.js?v=c2232aa7558e9517946129d2a1b8c770"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');
        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>